[gd_scene load_steps=24 format=3 uid="uid://bp3faj46c64ck"]

[ext_resource type="Script" uid="uid://ralk8skbs5p3" path="res://player/Player.gd" id="1"]
[ext_resource type="Script" uid="uid://bulvmqnteu5wm" path="res://player/input.gd" id="2_610ub"]
[ext_resource type="PackedScene" uid="uid://bs1di4sdp87y2" path="res://player/soldier/soldier_fp.glb" id="2_q83su"]
[ext_resource type="Script" uid="uid://da5guausa6d51" path="res://player/view_pivot.gd" id="3_610ub"]
[ext_resource type="Script" uid="uid://d350u8evihs1u" path="res://addons/netfox/rollback/rollback-synchronizer.gd" id="3_ayguc"]
[ext_resource type="Material" uid="uid://c67e1bprtx6g6" path="res://player/soldier/mat/hands_fp_mat.tres" id="4_8cy8x"]
[ext_resource type="Script" uid="uid://dour8fehaaugp" path="res://addons/netfox/tick-interpolator.gd" id="4_ayguc"]
[ext_resource type="Material" uid="uid://blvflicat0g82" path="res://player/soldier/mat/sleeves_mat_red.tres" id="5_610ub"]
[ext_resource type="PackedScene" uid="uid://sdbrfx65acjc" path="res://wep/Shotgun.tscn" id="10_d4g0h"]
[ext_resource type="PackedScene" uid="uid://b2xj212301c7a" path="res://wep/RocketLauncher.tscn" id="10_t8epa"]
[ext_resource type="PackedScene" uid="uid://pvo3x2g53ir3" path="res://wep/Generic.tscn" id="10_v4f8b"]
[ext_resource type="PackedScene" uid="uid://cba5mxu6nbqo3" path="res://wep/Shovel.tscn" id="12_uewl2"]
[ext_resource type="PackedScene" uid="uid://cxxkirdbyjvwa" path="res://wep/GrenadeLauncher.tscn" id="13_ofhxi"]
[ext_resource type="Script" uid="uid://e0acsamgskt8" path="res://player/weapon_manager.gd" id="15_m23wc"]
[ext_resource type="PackedScene" uid="uid://d3tlxp1tfmuf8" path="res://player/body/BodyModel.tscn" id="25_vdsxv"]
[ext_resource type="AudioStream" uid="uid://cqwxehsek2xdy" path="res://sfx/common/rocket_jump_wind.ogg" id="40_4f14b"]
[ext_resource type="AudioStream" uid="uid://chi7fdkssts2p" path="res://sfx/common/footstep/concrete.tres" id="44_w36ex"]
[ext_resource type="Script" uid="uid://cy8k051va8lv7" path="res://player/footstep_manager.gd" id="48_wpo5q"]

[sub_resource type="GDScript" id="GDScript_8cy8x"]
resource_name = "first_person_model"
script/source = "@icon(\"res://shared/icons/vr.png\")
extends Node3D
"

[sub_resource type="GDScript" id="GDScript_7vx8s"]
resource_name = "first_person_anim_player"
script/source = "extends AnimationPlayer


func _ready() -> void:
	# Primary.
	for anim in [&\"rocket_launcher_fire\", &\"rocket_launcher_draw\"]:
		animation_set_next(anim, &\"rocket_launcher_idle\")
	
	# Secondary.
	for anim in [&\"shotgun_fire\", &\"shotgun_draw_pump\", &\"shotgun_draw_no_pump\"]:
		animation_set_next(anim, &\"shotgun_idle\")
	
	set_blend_time(&\"shotgun_draw_lastshot_reload\", &\"shotgun_reload_start\", 0.2)
	
	# Melee.
	for anim in [&\"shovel_swing_a\", &\"shovel_swing_b\", &\"shovel_draw\"]:
		animation_set_next(anim, &\"shovel_idle\")

"

[sub_resource type="BoxShape3D" id="BoxShape3D_301pk"]
resource_local_to_scene = true
size = Vector3(0.914, 1.562, 0.914)

[sub_resource type="CapsuleShape3D" id="CapsuleShape3D_6j1es"]
resource_local_to_scene = true
radius = 0.457
height = 1.562

[sub_resource type="CylinderShape3D" id="CylinderShape3D_el3cl"]
resource_local_to_scene = true
height = 1.562
radius = 0.457

[node name="Player" type="CharacterBody3D" node_paths=PackedStringArray("view_pivot", "input", "weapon_manager", "hull", "body_mesh", "fp_mesh") groups=["players"]]
process_thread_group = 1
process_thread_group_order = 0
process_thread_messages = 0
collision_layer = 256
collision_mask = 257
floor_stop_on_slope = false
floor_block_on_wall = false
floor_max_angle = 0.802851
script = ExtResource("1")
view_pivot = NodePath("Pivot")
input = NodePath("Input")
weapon_manager = NodePath("Pivot/WeaponManager")
hull = NodePath("CollisionShapeBox")
body_mesh = NodePath("BodyModel/TPSkeleton/mesh")
fp_mesh = NodePath("Pivot/FirstPersonModel/FPSkeleton/mesh")

[node name="Input" type="Node" parent="."]
script = ExtResource("2_610ub")

[node name="RollbackSynchronizer" type="Node" parent="." node_paths=PackedStringArray("root")]
unique_name_in_owner = true
script = ExtResource("3_ayguc")
root = NodePath("..")
state_properties = Array[String]([":position", ":velocity", ":crouched", ":just_landed", ":just_jumped", ":wish_dir", ":grounded"])
input_properties = Array[String](["Input:movement", "Input:jumped", "Input:crouched", "Input:firing_primary", "Input:debug_network_use", "Pivot:rotation"])
metadata/_custom_type_script = "uid://d350u8evihs1u"

[node name="TickInterpolator" type="Node" parent="." node_paths=PackedStringArray("root")]
script = ExtResource("4_ayguc")
root = NodePath("..")
enabled = false
properties = Array[String]([":position"])
metadata/_custom_type_script = "uid://dour8fehaaugp"

[node name="Pivot" type="Node3D" parent="."]
physics_interpolation_mode = 2
script = ExtResource("3_610ub")

[node name="Camera" type="Camera3D" parent="Pivot"]
cull_mask = 1048571
fov = 85.0

[node name="FirstPersonModel" parent="Pivot" instance=ExtResource("2_q83su")]
transform = Transform3D(-1, 0, -9.81473e-08, 0, 1, 0, 1.50996e-07, 0, -0.65, 0, 0, 0)
script = SubResource("GDScript_8cy8x")

[node name="mesh" parent="Pivot/FirstPersonModel/FPSkeleton" index="0"]
layers = 2
surface_material_override/0 = ExtResource("4_8cy8x")
surface_material_override/1 = ExtResource("5_610ub")

[node name="AnimationPlayer" parent="Pivot/FirstPersonModel" index="1"]
autoplay = "rocket_launcher_draw"
script = SubResource("GDScript_7vx8s")

[node name="WeaponManager" type="Node3D" parent="Pivot" node_paths=PackedStringArray("tp", "fp", "primary_weapon", "secondary_weapon", "melee_weapon", "held_weapon")]
script = ExtResource("15_m23wc")
tp = NodePath("../../BodyModel")
fp = NodePath("../FirstPersonModel")
primary_weapon = NodePath("RocketLauncher")
secondary_weapon = NodePath("Shotgun")
melee_weapon = NodePath("Shovel")
held_weapon = NodePath("Generic")

[node name="Deploy" type="Timer" parent="Pivot/WeaponManager"]
process_callback = 0
one_shot = true

[node name="RocketLauncher" parent="Pivot/WeaponManager" instance=ExtResource("10_t8epa")]

[node name="Shotgun" parent="Pivot/WeaponManager" instance=ExtResource("10_d4g0h")]

[node name="Shovel" parent="Pivot/WeaponManager" instance=ExtResource("12_uewl2")]

[node name="GrenadeLauncher" parent="Pivot/WeaponManager" instance=ExtResource("13_ofhxi")]

[node name="Generic" parent="Pivot/WeaponManager" instance=ExtResource("10_v4f8b")]

[node name="CollisionShapeBox" type="CollisionShape3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0.781, 0)
shape = SubResource("BoxShape3D_301pk")

[node name="CollisionShapeCapsule" type="CollisionShape3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0.781, 0)
visible = false
shape = SubResource("CapsuleShape3D_6j1es")
disabled = true

[node name="CollisionShapeCylinder" type="CollisionShape3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0.781, 0)
visible = false
shape = SubResource("CylinderShape3D_el3cl")
disabled = true

[node name="BodyModel" parent="." node_paths=PackedStringArray("player") instance=ExtResource("25_vdsxv")]
player = NodePath("..")

[node name="SFX" type="Node3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1.34118, 0)

[node name="RocketJumpWind" type="AudioStreamPlayer3D" parent="SFX"]
stream = ExtResource("40_4f14b")
volume_db = -20.0
max_db = -20.0
max_distance = 1.0
max_polyphony = 10
attenuation_filter_cutoff_hz = 18520.0

[node name="Footstep" type="AudioStreamPlayer3D" parent="SFX"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0.000180006, 0)
top_level = true
stream = ExtResource("44_w36ex")
unit_size = 1.0
max_db = 0.0
max_distance = 5.0
attenuation_filter_cutoff_hz = 18520.0
script = ExtResource("48_wpo5q")

[node name="Step" type="Timer" parent="SFX/Footstep"]
process_callback = 0
one_shot = true

[editable path="Pivot/FirstPersonModel"]
